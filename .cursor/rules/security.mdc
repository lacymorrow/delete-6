---
description: Security Best Practices and Guidelines
globs: *.ts, *.tsx, src/server/*, src/lib/auth/*, middleware.*
alwaysApply: false
---

# Security Best Practices

## Authentication
- Implement proper auth flow
- Use secure sessions
- Handle password security
- Implement MFA
- Manage JWT securely
- Monitor auth attempts
- Regular security audits

## Authorization
- Implement role-based access
- Use proper middleware
- Validate permissions
- Handle edge cases
- Monitor access patterns
- Regular access reviews
- Document policies

## Data Protection
- Encrypt sensitive data
- Use proper hashing
- Implement data masking
- Handle PII properly
- Regular security scans
- Monitor data access
- Document procedures

## API Security
- Validate all inputs
- Use rate limiting
- Implement CORS properly
- Use proper headers
- Monitor API usage
- Regular security tests
- Document endpoints

## Webhook Security
- ALWAYS verify webhook signatures using timing-safe comparison
- Never accept webhooks without proper signature validation
- Use environment variables for webhook secrets
- Implement idempotency using unique event identifiers
- Validate all webhook payload fields before processing
- Never log sensitive data from webhook payloads
- Return proper HTTP status codes for webhook responses
- Implement rate limiting per webhook source
- Process webhooks asynchronously when possible
- Use database transactions for webhook data consistency

## Frontend Security
- Prevent XSS attacks
- Handle CSRF properly
- Secure form submissions
- Validate client input
- Monitor client security
- Regular security audits
- Document measures

## Backend Security
- Validate all inputs
- Use proper sanitization
- Handle file uploads securely
- Implement proper logging
- Monitor server security
- Regular security scans
- Document procedures

## Infrastructure
- Use proper firewalls
- Implement WAF
- Configure security groups
- Monitor infrastructure
- Regular security audits
- Document architecture
- Plan for incidents

## Compliance
- Follow security standards
- Implement compliance
- Regular audits
- Document procedures
- Monitor compliance
- Keep records
- Regular reviews

## Incident Response
- Have response plan
- Document procedures
- Regular drills
- Monitor incidents
- Have recovery plan
- Document lessons
- Regular updates

## Documentation
- Document security measures
- Keep procedures updated
- Document incidents
- Regular reviews
- Share best practices
- Monitor changes
- Maintain records
